<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <title>Untitled :: openEHR Specifications (Local Build)</title>
    <link rel="canonical" href="https://sebastian-iancu.github.io/antora-openehr/AM/latest/ADL2/master09.05-spec_object_redef/">
    <link rel="prev" href="../master09.04-spec_attrib_redef/">
    <link rel="next" href="../master09.06-spec_rules/">
    <meta name="description" content="openEHR Archetype Definition Language 2 (ADL2)">
    <meta name="keywords" content="EHR, ADL, AOM, health records, archetypes, constraint language, ISO 13606, openehr">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/antora-openehr.css">
    <link rel="stylesheet" href="../../../../_/css/openehr.css">
<link rel="icon" href="../../../../_/img/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://sebastian-iancu.github.io/antora-openehr">openEHR Specifications (Local Build)</a>

      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:AM"> Archetype Model only
          </label>
        </div>
      </div>

      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Specifications</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://specifications.openehr.org/" target="_blank">
              openEHR specification
            </a>
            <a class="navbar-item" href="https://specifications.openehr.org/releases/UML/development/index.html" target="_blank">
              openEHR portal
            </a>
            <a class="navbar-item" href="https://ckm.openehr.org/ckm/" target="_blank">
              openEHR CKM
            </a>
          </div>
        </div>

        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://openehr.atlassian.net/secure/Dashboard.jspa?selectPageId=10190" target="_blank">
              Issue trackers
            </a>
            <a class="navbar-item" href="https://discourse.openehr.org/" target="_blank">
              Discourse Forum
            </a>
            <a class="navbar-item" href="https://specifications.openehr.org/wiki/display/spec/Specifications+Home" target="_blank">
              Wiki
            </a>
            <a class="navbar-item" href="https://github.com/openEHR" target="_blank">
              GitHub
            </a>
          </div>
        </div>

      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="AM" data-version="development">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../../">Archetype Model</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../">Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../ADL1.4/">{spec_title}</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../ADL1.4/amendment_record/">Amendment Record</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../">{spec_title}</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../preface/">Preface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../file_encoding/">File Encoding and Character Quoting</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master04.1-cadl_overview/">cADL - Constraint ADL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master04.2-cadl_basics/">Master04.2-Cadl Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master04.3-cadl_complex_types/">Master04.3-Cadl Complex Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master04.4-cadl_second_order/">Master04.4-Cadl Second Order</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master04.5-cadl_primitive_types/">Master04.5-Cadl Primitive Types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master04.6-cadl_validity_rules/">Master04.6-Cadl Validity Rules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../paths/">ADL Paths</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../default_values/">Default Values</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.01-adl_introduction/">ADL - Archetype Definition Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.02-adl_conventions/">Master07.02-Adl Conventions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.03-adl_artefacts/">Master07.03-Adl Artefacts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.04-adl_basics/">Master07.04-Adl Basics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.05-adl_identification/">Master07.05-Adl Identification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.06-adl_specialise/">Master07.06-Adl Specialise</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.07-adl_language/">Master07.07-Adl Language</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.08-adl_description/">Master07.08-Adl Description</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.09-adl_deprecated/">Master07.09-Adl Deprecated</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.10-adl_definition/">Master07.10-Adl Definition</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.11-adl_rules/">Master07.11-Adl Rules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.12-adl_rm_overlay/">Master07.12-Adl Rm Overlay</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.13-adl_terminology/">Master07.13-Adl Terminology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master07.14-adl_annotations/">Master07.14-Adl Annotations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../terminology_integration/">Terminology Integration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.01-spec_overview/">Specialisation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.02-spec_concepts/">Master09.02-Spec Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.03-spec_examples/">Master09.03-Spec Examples</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.04-spec_attrib_redef/">Master09.04-Spec Attrib Redef</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="./">Master09.05-Spec Object Redef</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.06-spec_rules/">Master09.06-Spec Rules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.07-spec_languages/">Master09.07-Spec Languages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.08-spec_description/">Master09.08-Spec Description</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.09-spec_terminology/">Master09.09-Spec Terminology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../master09.10-spec_bindings/">Master09.10-Spec Bindings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../templates/">Templates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../other_formalisms/">Relationship of ADL to Other Formalisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../masterAppB-syntax_spec/">Syntax Specification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amendment_record/">Amendment Record</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../AOM1.4/">{spec_title}</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/preface/">Preface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/model_overview/">The Archetype Object Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/archetype_package/">The Archetype Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/constraint_model_package/">Constraint Model Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/assertion_package/">The Assertion Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/primitive_package/">Primitive Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/ontology_package/">Terminology Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/domain_extension/">Domain-specific Extension Example</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/masterAppB-diverse_reference_models/">Using Archetypes with Diverse Reference Models</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM1.4/amendment_record/">Amendment Record</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../AOM2/">{spec_title}</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/preface/">Preface</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/model_overview/">Model Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/archetype_package/">The Archetype Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/master04.1-constraint_model-overview/">Constraint Model Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/master04.2-constraint_model-semantics/">Master04.2-Constraint Model-Semantics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/master04.3-constraint_model-second_order/">Master04.3-Constraint Model-Second Order</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/master04.4-constraint_model-AOM_type_subs/">Master04.4-Constraint Model-AOM Type Subs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/master04.5-constraint_model-class_definitions/">Master04.5-Constraint Model-Class Definitions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/rules_package/">The Rules Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/rm_overlay/">The RM Overlay Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/terminology_package/">Terminology Package</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/validation/">Validation and Transformation Semantics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/serialisation_model/">Serialisation Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/templates/">Templates</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/rm_adaptation/">Reference Model Adaptation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../AOM2/amendment_record/">Amendment Record</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../Identification/">{spec_title}</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../Identification/amendment_record/">Amendment Record</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="#index.adoc">Language Design</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../OPT2/">{spec_title}</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../OPT2/amendment_record/">Amendment Record</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../Overview/">{spec_title}</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../Overview/amendment_record/">Amendment Record</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Archetype Model</span>
    <span class="version">development</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="../../../latest/">Archetype Model</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../latest/">Release-2.3.0</a>
        </li>
        <li class="version">
          <a href="../../../Release-2.2.0/">Release-2.2.0</a>
        </li>
        <li class="version is-current">
          <a href="../../">development</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../BASE/latest/">Base Model</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../BASE/latest/">Release-1.2.0</a>
        </li>
        <li class="version">
          <a href="../../../../BASE/Release-1.1.0/">Release-1.1.0</a>
        </li>
        <li class="version">
          <a href="../../../../BASE/development/">development</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../RM/latest/">Reference Model</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../RM/latest/">Release-1.1.0</a>
        </li>
        <li class="version">
          <a href="../../../../RM/Release-1.0.4/">Release-1.0.4</a>
        </li>
        <li class="version">
          <a href="../../../../RM/development/">development</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../BASE/latest/" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../">Archetype Model</a></li>
    <li><a href="../">{spec_title}</a></li>
    <li><a href="./">Master09.05-Spec Object Redef</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">development</button>
  <div class="version-menu">
    <a class="version" href="../../../latest/ADL2/master09.05-spec_object_redef/">Release-2.3.0</a>
    <a class="version is-missing" href="../../../Release-2.2.0/">Release-2.2.0</a>
    <a class="version is-current" href="./">development</a>
  </div>
</div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_object_redefinition"><a class="anchor" href="#_object_redefinition"></a><a class="link" href="#_object_redefinition">Object Redefinition</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Object redefinition can occur for any object constraint in the parent archetype, and can include redefinition of node identifier, occurrences, reference model type. For certain kinds of object constraints, specific kinds of redefinition are possible.</p>
</div>
<div class="sect2">
<h3 id="_node_identifiers"><a class="anchor" href="#_node_identifiers"></a><a class="link" href="#_node_identifiers">Node Identifiers</a></h3>
<div class="paragraph">
<p>In an archetype, node identifiers ('at-codes' / 'id-codes') are mandatory on all object constraint nodes. The identifiers of those object nodes defined as children of a multiply-valued attribute and multiple alternative children of single-valued attributes (see <a href="#_node_identifiers">Node Identifiers</a>) require definitions in the archetype terminology. Definitions are optional on other single child constraints of single-valued attributes. This rule applies in specialised as well as top-level archetypes.</p>
</div>
<div class="paragraph">
<p>A key question is: when does a node identifier need to be redefined? There are three possible situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when the node is the root node of an archetype, the meaning is always considered to be redefined;</p>
</li>
<li>
<p>it can be redefined for purely semantic purposes on other nodes, e.g. to redefine 'heart rate' to 'fetal heart rate';</p>
</li>
<li>
<p>a node identifier must be redefined if the node is being redefined into multiple child nodes, either under a multiply-valued attribute, or as alternatives under a single-valued attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Redefinition of an object node identifier for purely semantic purposes, unaccompanied by any other kind of constraint change is done as shown in the following example.</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div id="_tabs_1" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_1_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_1_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_1_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_1_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    EVALUATION[at0000] ∈ {                                      -- Medical Certificate
        data ∈ {
            ITEM_TREE[at0001] ∈ {
                items ∈ {
                    ELEMENT[at0004] occurrences ∈ {0..1} ∈ {   -- Description
                        value ∈ {
                            DV_TEXT[at9000]
                        }
                    }
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_1_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_1_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    EVALUATION[id1] ∈ {                                      -- Medical Certificate
        data ∈ {
            ITEM_TREE[id2] ∈ {
                items ∈ {
                    ELEMENT[id5] occurrences ∈ {0..1} ∈ {   -- Description
                        value ∈ {
                            DV_TEXT[id7]
                        }
                    }
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Child archetype:</p>
</div>
<div id="_tabs_2" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_2_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_2_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_2_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_2_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    EVALUATION[at0000.1] ∈ {                              -- Singapore Medical Certificate
        /data[at0001]/items ∈ {
            ELEMENT[at0004.1]                             -- Summary
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_2_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_2_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    EVALUATION[id1.1] ∈ {                              -- Singapore Medical Certificate
        /data[id2]/items ∈ {
            ELEMENT[id5.1]                             -- Summary
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here the <code>at0004</code> (<code>id5</code>) ('Description') node is refined in meaning to <code>at0004.1</code> (<code>id5.1</code>) ('Summary'). Since there is no other constraint to be stated, no further <code>matches</code> block is required.</p>
</div>
<div class="paragraph">
<p>An example of the 3rd case above of redefinition is shown in the first archetype in <a href="#redefinition_for_specialisation">[redefinition_for_specialisation]</a>, where the node <code>[at0078]</code> (<code>[id79]</code>) is redefined into a number of more specialised nodes <code>[at0078.2]</code> - <code>[at0078.9]</code> (<code>[id79.2]</code> - <code>[id79.9]</code>), while in the second, the identifier <code>[at0001]</code> (<code>[id2]</code>) is redefined to a single node <code>[at0001.1]</code> (<code>[id2.1]</code>).</p>
</div>
<div class="paragraph">
<p>The syntactic form of the identifier of a redefined node is a copy of the original followed by a dot ('.'), optionally intervening instances of the pattern '0.' and then a further non-zero number, i.e.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>at-coded archetypes: <code>atNNNN {.0}* .N</code></p>
</li>
<li>
<p>id-coded archetypes: <code>idN {.0}* .N</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This permits node identifiers from a given level to be redefined not just at the next level, but at multiple levels below.</p>
</div>
<div class="paragraph">
<p>The following are examples of redefined node identifiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>at-coded archetypes:</p>
<div class="ulist">
<ul>
<li>
<p><code>at0001.1</code>: redefinition of <code>at0001</code> at level 1 specialisation;</p>
</li>
<li>
<p><code>at0001.0.1</code>: redefinition of <code>at0001</code> node in level 2 specialisation archetype;</p>
</li>
<li>
<p><code>at0001.1.1</code>: redefinition of <code>at0001.1</code> in level 2 specialisation archetype.</p>
</li>
</ul>
</div>
</li>
<li>
<p>id-coded archetypes:</p>
<div class="ulist">
<ul>
<li>
<p><code>id2.1</code>: redefinition of <code>id2</code> at level 1 specialisation;</p>
</li>
<li>
<p><code>id2.0.1</code>: redefinition of <code>id2</code> node in level 2 specialisation archetype;</p>
</li>
<li>
<p><code>id2.1.1</code>: redefinition of <code>id2.1</code> in level 2 specialisation archetype.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The digits '1' and '2' here should not be confused with levels 1 and 2. The above identifiers based on an <code>at0005</code> (<code>id6</code>) node might easily be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>at-coded archetypes:</p>
<div class="ulist">
<ul>
<li>
<p><code>at0005.7</code>: redefinition of <code>at0005</code> in a level 1 specialisation archetype;</p>
</li>
<li>
<p><code>at0005.0.8</code>: redefinition of <code>at0005</code> node in a level 2 specialisation archetype;</p>
</li>
<li>
<p><code>at0005.7.8</code>: redefinition of <code>at0005.7</code> in a level 2 specialisation archetype.</p>
</li>
</ul>
</div>
</li>
<li>
<p>id-coded archetypes:</p>
<div class="ulist">
<ul>
<li>
<p><code>id6.7</code>: redefinition of <code>id6</code> in a level 1 specialisation archetype;</p>
</li>
<li>
<p><code>id6.0.8</code>: redefinition of <code>id6</code> node in a level 2 specialisation archetype;</p>
</li>
<li>
<p><code>id6.7.8</code>: redefinition of <code>id6.7</code> in a level 2 specialisation archetype.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_adding_nodes"><a class="anchor" href="#_adding_nodes"></a><a class="link" href="#_adding_nodes">Adding Nodes</a></h4>
<div class="paragraph">
<p>Added object constraint nodes carry identifiers according to the rule mentioned above. The second example includes the new node identifiers <code>at0.32</code> , <code>at0.35</code> and <code>at0.37</code> (<code>id0.32</code> , <code>id0.35</code> and <code>id0.37</code>), whose codes start with a '0'. indicating that they have no equivalent code in the parent archetype.</p>
</div>
<div class="paragraph">
<p>The node identifier syntax of an extension node commences with at least one instance of the pattern '0.'. The structure of node identifiers for both kinds of node thus always indicates at what level the identifier was introduced, given by the number of dots.</p>
</div>
<div class="paragraph">
<p>Examples of added node identifiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>at-coded archetypes:</p>
<div class="ulist">
<ul>
<li>
<p><code>at0.1</code>  : identifier of extension node introduced at level 1;</p>
</li>
<li>
<p><code>at0.0.1</code>: identifier of extension node introduced at level 2.</p>
</li>
</ul>
</div>
</li>
<li>
<p>id-coded archetypes:</p>
<div class="ulist">
<ul>
<li>
<p><code>id0.1</code>  : identifier of extension node introduced at level 1;</p>
</li>
<li>
<p><code>id0.0.1</code>: identifier of extension node introduced at level 2.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When a flat form is created, the level at which any given node was introduced or redefined is clear due to the identifier coding system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_occurrences_redefinition"><a class="anchor" href="#_occurrences_redefinition"></a><a class="link" href="#_occurrences_redefinition">Occurrences Redefinition</a></h3>
<div class="paragraph">
<p>The <code>occurrences</code> constraint on an object node indicates how many instances within the data may conform to that constraint (see <a href="#Container Attributes">[Container Attributes]</a>). Occurrences may be redefined for various reasons, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mandation of specific specialised objects;</p>
</li>
<li>
<p>exclusion of certain objects from the parent;</p>
</li>
<li>
<p>controlling occurrences of a specialised object to a specific range.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A basic distinction should be understood prior to considering these specific cases, which is a difference between redefinition of occurrences on a single-occurrence node versus a multiple-occurrence node.</p>
</div>
<div class="paragraph">
<p>A single-occurrence node is one whose effective occurrences has an upper limit of 1, i.e. it can occur either 0..1 or 1 times in data. This is the case for any object node under a single-valued attribute, as well as any object node under a container attribute, that has occurrences set to either 0..1 or 1. The occurrences of such a node can only be redefined in very limited ways, i.e. mandation or exclusion of 0..1.</p>
</div>
<div class="paragraph">
<p>The situation is different for object nodes with multiple occurrences, i.e. whose effective occurrences upper limit is greater than one. The example provided above in <a href="#Redefinition for Specialisation">[Redefinition for Specialisation]</a> in which node <code>at0078|panel item|</code> (<code>id79|panel item|</code>) in the parent archetype is specialised into multiple nodes <code>at0078.1</code>, <code>at0078.2</code> (<code>id79.1</code>, <code>id79.2</code>) etc, illustrates the standard pattern. When a parent object (the <code>at0078</code> (<code>id79</code>) node in the parent archetype) has multiple occurrences, it defines a potential <em>multiplicity</em> of data objects that may conform to it. When such a node is redefined into multiple specialised child nodes in a child archetype (each typically having its own occurrences constraint), the latter <em>specialisation set</em> acts as a more precise restatement of the original multiplicity of objects. For this reason, the <em>collective occurrences</em> of the specialised children is used to determine their validity, rather than any individual comparison of the occurrences of one specialised child to that of the parent.</p>
</div>
<div class="paragraph">
<p>The formal definition of validity for occurrences in both cases is given by the VSONCO rule in the <a href="https://specifications.openehr.org/releases/AM/latest/AOM2.html#_validity_rules_3" target="_blank" rel="noopener">openEHR AOM2 specification</a>.</p>
</div>
<div class="sect3">
<h4 id="_mandation"><a class="anchor" href="#_mandation"></a><a class="link" href="#_mandation">Mandation</a></h4>
<div class="paragraph">
<p>Within container attributes, <code>occurrences</code> is usually redefined in order to make a given object mandatory rather than optional. In the following example, the occurrences of the <code>at0003</code> (<code>id4</code>) node is redefined from <code>{0..1}</code> i.e. optional, to <code>{1}</code> , i.e. mandatory.</p>
</div>
<div class="paragraph">
<p>Parent (<code>openEHR-EHR-EVALUATION.problem.v1.0.3</code>):</p>
</div>
<div id="_tabs_3" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_3_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_3_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_3_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_3_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    EVALUATION[at0000] ∈ { -- Problem
        data ∈ {
            ITEM_TREE[at0001] ∈ {
                items cardinality ∈ {0..*; ordered} ∈ {
                    ELEMENT[at0002] occurrences ∈ {1} ∈ {...}       -- Problem
                    ELEMENT[at0003] occurrences ∈ {0..1} ∈ {...}    -- Date of initial onset
                    -- etc
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_3_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_3_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    EVALUATION[id1] ∈ { -- Problem
        data ∈ {
            ITEM_TREE[id2] ∈ {
                items cardinality ∈ {0..*; ordered} ∈ {
                    ELEMENT[id3] occurrences ∈ {1} ∈ {...}       -- Problem
                    ELEMENT[id4] occurrences ∈ {0..1} ∈ {...}    -- Date of initial onset
                    -- etc
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Child (<code>openEHR-EHR-EVALUATION.problem-diagnosis.v1</code>):</p>
</div>
<div id="_tabs_4" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_4_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_4_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_4_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_4_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[at0001]/items ∈ {
        ELEMENT[at0003] occurrences ∈ {1}  -- Date of initial onset
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_4_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_4_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[id2]/items ∈ {
        ELEMENT[id4] occurrences ∈ {1}  -- Date of initial onset
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the above we can see that if the only change in the redefinition is to occurrences, the remainder of the block from the parent is not repeated in the child.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exclusion"><a class="anchor" href="#_exclusion"></a><a class="link" href="#_exclusion">Exclusion</a></h4>
<div class="paragraph">
<p>Occurrences is most commonly constrained on child objects of container attributes, but can be set on objects of any attribute to effect exclusion of part of the instance space. This can be useful in archetypes where a number of alternatives for a single-valued attribute have been stated, and the need is to remove some alternatives in a specialised child archetype. For example, an archetype might have the following constraint:</p>
</div>
<div id="_tabs_5" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_5_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_5_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_5_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_5_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ELEMENT[at0002] ∈ {
        value ∈ {
            DV_QUANTITY[at9000] ∈ {...}
            DV_INTERVAL&lt;DV_QUANTITY&gt;[at9001] ∈ {...}
            DV_COUNT[at9002] ∈ {...}
            DV_INTERVAL&lt;DV_COUNT&gt;[at9003] ∈ {...}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_5_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_5_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ELEMENT[id3] ∈ {
        value ∈ {
            DV_QUANTITY[id4] ∈ {...}
            DV_INTERVAL&lt;DV_QUANTITY&gt;[id5] ∈ {...}
            DV_COUNT[id6] ∈ {...}
            DV_INTERVAL&lt;DV_COUNT&gt;[id7] ∈ {...}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>and the intention is to remove the <code>DV_INTERVAL&lt;*&gt;</code> alternatives. This is achieved by redefining the enclosing object to remove the relevant types:</p>
</div>
<div id="_tabs_6" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_6_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_6_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_6_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_6_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ELEMENT[at0002] ∈ {
        value ∈ {
            DV_INTERVAL&lt;DV_QUANTITY&gt;[at9000] occurrences ∈ {0}
            DV_INTERVAL&lt;DV_COUNT&gt;[at9003] occurrences ∈ {0}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_6_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_6_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ELEMENT[id3] ∈ {
        value ∈ {
            DV_INTERVAL&lt;DV_QUANTITY&gt;[id4] occurrences ∈ {0}
            DV_INTERVAL&lt;DV_COUNT&gt;[id7] occurrences ∈ {0}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Exclusion by setting occurrences to <code>{0}</code> is also common in templates, and is used to remove specific child objects of container attributes, as in the following example:</p>
</div>
<div id="_tabs_7" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_7_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_7_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_7_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_7_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[at0001]/items ∈ {
        CLUSTER[at0025] occurrences ∈ {0}     -- remove 'Related problems'
        ELEMENT[at0030] occurrences ∈ {0}     -- remove 'Age at resolution'
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_7_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_7_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[id2]/items ∈ {
        CLUSTER[id26] occurrences ∈ {0}     -- remove 'Related problems'
        ELEMENT[id31] occurrences ∈ {0}     -- remove 'Age at resolution'
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If the whole attribute is to be removed, this can be done by redefining existence to <code>{0}</code>, as described in <a href="#Existence Redefinition: Mandation and Exclusion">[Existence Redefinition: Mandation and Exclusion]</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_single_and_multiple_specialisation_when_does_cloning_occur"><a class="anchor" href="#_single_and_multiple_specialisation_when_does_cloning_occur"></a><a class="link" href="#_single_and_multiple_specialisation_when_does_cloning_occur">Single and Multiple Specialisation - When does Cloning Occur?</a></h3>
<div class="paragraph">
<p>In the <a href="#Examples">examples shown above</a> there are two types of redefinition occurring. The first shows a single node in the parent archetype redefined by a single node, both identified by <code>at0003</code> (<code>id4</code>). The second shows a single node in the parent redefined by multiple children. In the first example, the result of flattening is <em>in-place overlaying</em>, while in the second, it is <em>cloning with overlaying</em>. The consequence of the second type of redefinition is that the original parent node survives in its original form in the child archetype, whereas in the first, it is replaced. The reasoning behind this is that redefinition to multiple children is taken to mean that later redefinition to multiple children may occur in deeper child archetypes, and for this to occur, the original parent needs to be left intact. Conversely, the single-parent / single-child redefinition is taken to mean a logical refinement of an existing node, which should therefore be logically replaced.</p>
</div>
<div class="paragraph">
<p>The formal rule for whether cloning occurs or not is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    clone not needed = max effective_occurrences of object node in parent archetype = 1 OR
        object node in child differential archetype is sole child of its parent, and has max occurrences = 1</pre>
</div>
</div>
<div class="paragraph">
<p>The first case corresponds to the situation where the 'effective occurrences' of any child of an attribute can be inferred to be maximum 1, i.e. either the attribute is single-valued, or it is a container with a cardinality constraint with maximum 1. The second is where the object in the child archetype has an explicit occurrences constraint of max 1. In the above, the <code><em>effective_occurrences</em></code> function is defined in the <a href="https://specifications.openehr.org/releases/AM/latest/AOM2.html#_occurrences_inferencing_rules">AOM2 specification</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exhaustive_and_non_exhaustive_redefinition"><a class="anchor" href="#_exhaustive_and_non_exhaustive_redefinition"></a><a class="link" href="#_exhaustive_and_non_exhaustive_redefinition">Exhaustive and Non-Exhaustive Redefinition</a></h3>
<div class="paragraph">
<p>In any multiple specialisation situation, there is a question of whether the original node being specialised (e.g. <code>at0078</code> (<code>id79</code>) and <code>at0001</code> (<code>id2</code>) in the examples above) remains available for further redefinition in subsequent child archetypes, or do the redefinition children <em>exhaustively</em> define the instance space for the given parent node?</p>
</div>
<div class="paragraph">
<p>Should these children be considered exhaustive? One point of view says so, since all subsequently discovered varieties of hepatitis (C, D, E, etc) would now become children of 'hepatitis non-A non-B'. However, this is likely to be sub-optimal, since now the category 'hepatitis non-A non-B' probably exists solely because of the order in which the various hepatitis virus tests were perfected. Therefore an alternative argument would say that the categories 'hepatitis C', 'hepatitis D' etc should be defined directly below 'hepatitis', as if 'hepatitis non-A non-B' had never existed. Under this argument, the children would not be declared, even when they are theoretically exhaustive.</p>
</div>
<div class="paragraph">
<p>This kind of argument comes up time and again, and the need for catch-all categories (archetype nodes) and the possibility of future discoveries cannot be predicted. Even in situations such as a lab result (e.g. cholesterol), where the list of analytes seem to be known and fixed, experience of clinical modellers has shown that there is nevertheless no guarantee of not needing another data point, perhaps for something other than an analyte.</p>
</div>
<div class="paragraph">
<p>The default situation is that child redefinition nodes do not exhaustively replace the parent unless explicitly stated otherwise. This may be done by excluding the parent node in the normal way, i.e. using <code>occurrences matches {0}</code>. <strong>If an exclusion node is included, it must come last</strong> in the set of siblings that specialise the parent node, otherwise a deletion will occur, leaving no node to specialise. The first example would then become:</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div id="_tabs_8" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_8_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_8_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_8_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_8_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    items cardinality ∈ {0..*; unordered} ∈ {
        CLUSTER[at0003] occurrences ∈ {1} ∈ {...}                          -- Specimen
        CLUSTER[at0010] occurrences ∈ {0..*} ∈ {...}                      -- level 1
        ELEMENT[at0078] occurrences ∈ {0..*} ∈ {                          -- panel item
            value ∈ {*}
        }
        ELEMENT[at0016] occurrences ∈ {0..1} ∈ {...}                      -- Overall Comment
        ELEMENT[at0036] occurrences ∈ {0..1} ∈ {...}                      -- Multimedia rep.
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_8_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_8_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    items cardinality ∈ {0..*; unordered} ∈ {
        CLUSTER[id4] occurrences ∈ {1} ∈ {...}                          -- Specimen
        CLUSTER[id11] occurrences ∈ {0..*} ∈ {...}                      -- level 1
        ELEMENT[id79] occurrences ∈ {0..*} ∈ {                          -- panel item
            value ∈ {*}
        }
        ELEMENT[id17] occurrences ∈ {0..1} ∈ {...}                      -- Overall Comment
        ELEMENT[id37] occurrences ∈ {0..1} ∈ {...}                      -- Multimedia rep.
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Child archetype:</p>
</div>
<div id="_tabs_9" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_9_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_9_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_9_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_9_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data/events[at0001]/data/items ∈ {
        ELEMENT[at0078.1] occurrences ∈ {0..1} ∈ {...}                    -- TSH
        ELEMENT[at0078.2] occurrences ∈ {0..1} ∈ {...}                    -- Free Triiodothyronine
        ELEMENT[at0078.3] occurrences ∈ {0..1} ∈ {...}                    -- Total Triiodothyronine
        ELEMENT[at0078.4] occurrences ∈ {0..1} ∈ {...}                    -- Free thyroxine (Free T4)
        ELEMENT[at0078.5] occurrences ∈ {0..1} ∈ {...}                    -- Total Thyroxine (Total T4)
        ELEMENT[at0078.6] occurrences ∈ {0..1} ∈ {...}                    -- T4 loaded uptake
        ELEMENT[at0078.7] occurrences ∈ {0..1} ∈ {...}                    -- Free Triiodothyronine index
        ELEMENT[at0078.8] occurrences ∈ {0..1} ∈ {...}                    -- Free thyroxine index (FTI)
        ELEMENT[at0078] occurrences ∈ {0}                                  -- MUST COME LAST!
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_9_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_9_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data/events[id2]/data/items ∈ {
        ELEMENT[id79.1] occurrences ∈ {0..1} ∈ {...}                    -- TSH
        ELEMENT[id79.2] occurrences ∈ {0..1} ∈ {...}                    -- Free Triiodothyronine
        ELEMENT[id79.3] occurrences ∈ {0..1} ∈ {...}                    -- Total Triiodothyronine
        ELEMENT[id79.4] occurrences ∈ {0..1} ∈ {...}                    -- Free thyroxine (Free T4)
        ELEMENT[id79.5] occurrences ∈ {0..1} ∈ {...}                    -- Total Thyroxine (Total T4)
        ELEMENT[id79.6] occurrences ∈ {0..1} ∈ {...}                    -- T4 loaded uptake
        ELEMENT[id79.7] occurrences ∈ {0..1} ∈ {...}                    -- Free Triiodothyronine index
        ELEMENT[id79.8] occurrences ∈ {0..1} ∈ {...}                    -- Free thyroxine index (FTI)
        ELEMENT[id79] occurrences ∈ {0}                                  -- MUST COME LAST!
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Without the above specification, a deeper child archetype could then redefine both the original <code>at0078</code> (<code>id79</code>) node (e.g. into <code>at0078.0.1</code> , <code>at0078.0.2</code> (<code>id79.0.1</code> , <code>id79.0.2</code>)), and any of the <code>at0078.x</code> (<code>id79.x</code>) nodes (e.g. <code>at0078.1.1</code> , <code>at0078.1.2</code> (<code>id79.1.1</code> , <code>id79.1.2</code>)); with it, only the latter is possible. The <code>at0078</code> (<code>id79</code>) node can thus be considered to be logically 'frozen', in a similar way to frozen class methods in some programming languages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reference_model_type_refinement"><a class="anchor" href="#_reference_model_type_refinement"></a><a class="link" href="#_reference_model_type_refinement">Reference Model Type Refinement</a></h3>
<div class="paragraph">
<p>The type of an object may be redefined to one of its subtypes as defined by the reference model. A typical example of where this occurs in archetypes based on the openEHR reference model is when <code>ELEMENT.<em>value</em></code> is constrained to <code>*</code> in a parent archetype, meaning 'no further constraint on its RM type of <code>DATA_VALUE</code>, but is then constrained in a specialised archetype to subtypes of <code>DATA_VALUE</code>, e.g. <code>DV_QUANTITY</code> or <code>DV_PROPORTION</code> (see <a href="https://specifications.openehr.org/releases/RM/latest/data_types.html" target="_blank" rel="noopener">openEHR Data Types</a>). The following figure contains a simplified extract of the data values part of the openEHR reference model, and is the basis for the examples below.</p>
</div>
<div id="rm_type_structure" class="imageblock text-center text-center">
<div class="content">
<img src="../_images/diagrams/RM-data_types-overview.svg" alt="RM data types overview" width="50%">
</div>
<div class="title">Figure 1. Example Reference Model type structure</div>
</div>
<div class="paragraph">
<p>The most basic form of type refinement is shown in the following example:</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    value ∈ {*} -- any subtype of DATA_VALUE, from the ref model</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specialised archetype:</p>
</div>
<div id="_tabs_10" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_10_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_10_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_10_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_10_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[at9000] -- now limit to the DV_QUANTITY subtype
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_10_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_10_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[id8] -- now limit to the DV_QUANTITY subtype
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The meaning of the above is that instance data constrained by the specialised archetype at the value node must match the <code>DV_QUANTITY</code> constraint only - no other subtype of <code>DATA_VALUE</code> is allowed.</p>
</div>
<div class="paragraph">
<p>When a type in an archetype is redefined into one of its subtypes, any existing constraints on the original type in the parent archetype are respected. In the following example, a <code>DV_AMOUNT</code> constraint that required <em>accuracy</em> to be present and in the range +/-5% is refined into a <code>DV_QUANTITY</code> in which two attributes of the subtype are constrained. The original <em>accuracy</em> attribute is inherited without change.</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div id="_tabs_11" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_11_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_11_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_11_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_11_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    value ∈ {
        DV_AMOUNT[at9000] ∈ {
            accuracy ∈ {|-0.05..0.05|}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_11_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_11_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    value ∈ {
        DV_AMOUNT[id4] ∈ {
            accuracy ∈ {|-0.05..0.05|}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specialised archetype:</p>
</div>
<div id="_tabs_12" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_12_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_12_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_12_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_12_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[at9000] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_12_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_12_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[id4] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the same manner, an object node can be specialised into more than one subtype, where each such constraint selects a mutually exclusive subset of the instance space. The following example shows a specialisation of the <code>DV_AMOUNT</code> constraint above into two sub-typed constraints.</p>
</div>
<div id="_tabs_13" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_13_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_13_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_13_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_13_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[at9000.1] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
        DV_PROPORTION[at9000.2] ∈ {
            numerator ∈ {|2.0..10.0|}
            type ∈ {1} -- pk_unitary
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_13_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_13_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[id4.1] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
        DV_PROPORTION[id4.2] ∈ {
            numerator ∈ {|2.0..10.0|}
            type ∈ {1} -- pk_unitary
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Here, instance data may only be of type <code>DV_QUANTITY</code> or <code>DV_PROPORTION</code>, and must satisfy the respective constraints for those types.</p>
</div>
<div class="paragraph">
<p>A final variant of subtyping is when the intention is to constraint the data to a supertype with exceptions for particular subtypes. In this case, constraints based on subtypes are matched first, with the constraint based on the parent type being used to constrain all other subtypes. The following example constrains data at the <em>value</em> node to be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an instance of <code>DV_QUANTITY</code> with <em>magnitude</em> within the given range etc;</p>
</li>
<li>
<p>an instance of <code>DV_PROPORTION</code> with <em>numerator</em> in the given range etc;</p>
</li>
<li>
<p>an instance of any other subtype of <code>DV_AMOUNT</code>, with <em>accuracy</em> in the given range.</p>
</li>
</ul>
</div>
<div id="_tabs_14" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_14_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_14_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_14_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_14_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[at9000] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
        DV_PROPORTION[at9001] ∈ {
            numerator ∈ {|2.0..10.0|}
            type ∈ {pk_unitary}
        }
        DV_AMOUNT[at9002] ∈ {
            accuracy ∈ {|-0.05..0.05|}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_14_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_14_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[id4] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
        DV_PROPORTION[id5] ∈ {
            numerator ∈ {|2.0..10.0|}
            type ∈ {pk_unitary}
        }
        DV_AMOUNT[id6] ∈ {
            accuracy ∈ {|-0.05..0.05|}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A typical use of this kind of refinement in openEHR would be to add an alternative for a <code>DV_CODED_TEXT</code> constraint for a specific terminology to an existing <code>DV_TEXT</code> constraint in a <code><em>name</em></code> attribute, as follows:</p>
</div>
<div id="_tabs_15" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_15_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_15_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_15_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_15_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ...
        name ∈ {
            DV_CODED_TEXT[at0078] ∈ {
                defining_code ∈ {[ac1]}
            }
            DV_TEXT[at0013] ∈ {
                value ∈ {/.+/} -- non-empty string
            }
        }
    ...

terminology
    ...
    term_bindings = &lt;
        ["snomed_ct"]    = &lt;
            ["ac1"] = &lt;http://snomed.info/123456789&gt; -- any SNOMED CT code
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_15_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_15_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ...
        name ∈ {
            DV_CODED_TEXT[id79] ∈ {
                defining_code ∈ {[ac1]}
            }
            DV_TEXT[id14] ∈ {
                value ∈ {/.+/} -- non-empty string
            }
        }
    ...

terminology
    ...
    term_bindings = &lt;
        ["snomed_ct"]    = &lt;
            ["ac1"] = &lt;http://snomed.info/123456789&gt; -- any SNOMED CT code
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>All of the above specialisations based on reference model subtypes can be applied in the same way to identified object constraints.</p>
</div>
</div>
<div class="sect2">
<h3 id="_internal_reference_proxy_object_redefinition"><a class="anchor" href="#_internal_reference_proxy_object_redefinition"></a><a class="link" href="#_internal_reference_proxy_object_redefinition">Internal Reference (Proxy Object) Redefinition</a></h3>
<div class="paragraph">
<p>An archetype proxy object, or <code>use_node</code> constraint is used to refer to an object constraint from a point elsewhere in the archetype. These references can be redefined in two ways, as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Target redefinition: the target constraint of reference may be itself redefined. The meaning for this is that all internal references now assume the redefined form.</p>
</li>
<li>
<p>Reference redefinition: specialised archetypes can redefine a use_node object into a normal inline concrete constraint that a) replaces the reference, and b) must be completely conformant to the structure which is the target of the original reference.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that if the intention is to redefine a structure referred to by <code>use_node</code> constraints, but to leave the constraints at the reference source points in form to which the reference points in the parent level, each <code>use_node</code> reference needs to be manually redefined as a copy of the target structure originally pointed to.</p>
</div>
<div class="paragraph">
<p>The second type of redefinition above is the most common, and is shown in the following example.</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div id="_tabs_16" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_16_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_16_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_16_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_16_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ENTRY[at0000]∈ {
        data ∈ {
            CLUSTER[at0001] ∈ {
                items ∈ {
                    -- etc --
                }
            }
            use_node CLUSTER[at0002] /data[at0001]
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_16_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_16_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ENTRY[id1]∈ {
        data ∈ {
            CLUSTER[id2] ∈ {
                items ∈ {
                    -- etc --
                }
            }
            use_node CLUSTER[id3] /data[id2]
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Child archetype:</p>
</div>
<div id="_tabs_17" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_17_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_17_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_17_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_17_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ENTRY [at0000.1]∈ {
        /data[at0002]/items ∈ {
            ELEMENT [at0.1] ∈ {
                -- etc --
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_17_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_17_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ENTRY [id1.1]∈ {
        /data[id3]/items ∈ {
            ELEMENT [id0.1] ∈ {
                -- etc --
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Remembering that the parent archetype is essentially just definition two sibling object structures with the identifiers <code>at0000</code> and <code>at0001</code> (<code>id1</code> and <code>id2</code>) (defined by the use_node reference), the child is redefining the <code>at0001</code> (<code>id2</code>) node (it could have redefined the <code>at0000</code> (<code>id1</code>) node as well). The result of this in the flattened output is as follows:</p>
</div>
<div id="_tabs_18" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_18_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_18_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_18_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_18_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ENTRY [at0000.1] ∈ {
        data ∈ {
            CLUSTER[at0001] ∈ {
                items ∈ {
                    -- etc --
                }
            }
            CLUSTER[at0002] ∈ {
                items ∈ {
                    ELEMENT[at0.1] ∈ {
                        -- etc --
                    }
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_18_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_18_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    ENTRY [id1.1] ∈ {
        data ∈ {
            CLUSTER[id2] ∈ {
                items ∈ {
                    -- etc --
                }
            }
            CLUSTER[id3] ∈ {
                items ∈ {
                    ELEMENT[id0.1] ∈ {
                        -- etc --
                    }
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There is one subtlety to do with redefinition of occurrences of a use_node target: if it is redefined to have occurrences matches <code>{0}</code> (normally only in a template), then the effect of this is the same on any use_node reference definitions, unless they define occurrences locally at the reference point. The chance of this actually occurring appears vanishingly small, since by the time 'exclusion' occurrence redefinition is being done in templates, use_node object definitions are most likely to have been locally overridden anyway.</p>
</div>
<div class="paragraph">
<p>Lastly, one further type of redefinition appears technically possible, but seems of no utility, and is therefore not part of ADL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reference re-targeting: an internal reference could potentially be redefined into a reference to a different target whose structure conforms to the original target.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_external_reference_redefinition"><a class="anchor" href="#_external_reference_redefinition"></a><a class="link" href="#_external_reference_redefinition">External Reference Redefinition</a></h3>
<div class="paragraph">
<p>External reference nodes can be redefined by another external reference node, in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>exclusion - using the occurrences matches <code>{0}</code> method;</p>
</li>
<li>
<p>semantic refinement of the node identifier in the normal way;</p>
</li>
<li>
<p>redefinition of the reference to another archetype which is a specialisation of the one from the corresponding reference node in the flat parent.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_slot_filling_and_redefinition"><a class="anchor" href="#_slot_filling_and_redefinition"></a><a class="link" href="#_slot_filling_and_redefinition">Slot Filling and Redefinition</a></h3>
<div class="paragraph">
<p>Slots and slot-filling is a special kind of 'redefinition' in ADL, normally only used in templates. Logically, an archetype slot constraint is understood to consist of a) its definition (what archetypes are allowed to fill it) and b) current filler list. At the point of definition, the current fillers is invariably empty. More specialised descendants can progressively add or replace fillers for a slot. Thus, the appearance of an object node whose identifier is the specialisation of a slot node in the flat parent is always understood as a partial specialisation for it.</p>
</div>
<div class="paragraph">
<p>In other words, a slot within an archetype can be specialised by any combination of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>one or more slot-fillers;</p>
</li>
<li>
<p>a redefinition of the slot itself, either to narrow the set of archetypes it matches, or to close it to filling in either further specialisations, or at runtime, or to remove it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both types of redefinition are generally used by templates rather than published archetypes, since the business of filling slots is mostly related to local use-case specific uses of archetypes rather than part of the initial design.</p>
</div>
<div class="paragraph">
<p>The following example shows a slot from a <code>SECTION</code> archetype for the 'history_medical_surgical' archetype.</p>
</div>
<div id="_tabs_19" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_19_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_19_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_19_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_19_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    SECTION[at0000] ∈ {    -- Past history
        items ∈ {
            allow_archetype EVALUATION[at0001] ∈ { -- Past problems
                include
                    archetype_id/value ∈ {
                        /openEHR-EHR-EVALUATION\.clinical_synopsis\.v1
                            |openEHR-EHR-EVALUATION\.excluded(-[a-z0-9_]+)*\.v1
                            |openEHR-EHR-EVALUATION\.injury\.v1
                            |openEHR-EHR-EVALUATION\.problem(-[a-z0-9_]+)*\.v1/}
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_19_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_19_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    SECTION[id1] ∈ {    -- Past history
        items ∈ {
            allow_archetype EVALUATION[id2] ∈ { -- Past problems
                include
                    archetype_id/value ∈ {
                        /openEHR-EHR-EVALUATION\.clinical_synopsis\.v1
                            |openEHR-EHR-EVALUATION\.excluded(-[a-z0-9_]+)*\.v1
                            |openEHR-EHR-EVALUATION\.injury\.v1
                            |openEHR-EHR-EVALUATION\.problem(-[a-z0-9_]+)*\.v1/}
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This slot specification allows <code>EVALUATION</code> archetypes for the concepts 'clinical synopsis', various kinds of 'exclusions' and 'problems', and 'injury' to be used, and no others. The following fragment of ADL shows how the slot is filled in a template, using the keyword <code>use_archetype</code>. In this syntax, the node identification is a variation on the normal archetype at-codes (id-codes). Within the template, the identifier of the used archetype is also the identifier of that node. However, the original at-code (if defined) must also be mentioned, to indicate which slot the used archetype is filling. Templates may also be used to fill slots in the same way. Thus, in the following example, two archetypes and a template are designated to fill the <code>at0001</code> (<code>id2</code>) slot defined in the above fragment of ADL. The slot definition is not mentioned, so it remains unchanged, i.e. 'open'.</p>
</div>
<div id="_tabs_20" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_20_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_20_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_20_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_20_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    SECTION[at0000] ∈ {    -- Past history
        /items ∈ {
            use_archetype EVALUATION[at0001, org.openehr::openEHR-EHR-EVALUATION.problem.v1]
            use_archetype EVALUATION[at0001, uk.nhs.cfh::openEHR-EHR-EVALUATION.t_ed_diagnosis.v1]
            use_archetype EVALUATION[at0001, org.openehr::openEHR-EHR-EVALUATION.clin_synopsis.v1]
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_20_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_20_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    SECTION[id1] ∈ {    -- Past history
        /items ∈ {
            use_archetype EVALUATION[id2, org.openehr::openEHR-EHR-EVALUATION.problem.v1]
            use_archetype EVALUATION[id2, uk.nhs.cfh::openEHR-EHR-EVALUATION.t_ed_diagnosis.v1]
            use_archetype EVALUATION[id2, org.openehr::openEHR-EHR-EVALUATION.clin_synopsis.v1]
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Slots can be recursively filled in the above fashion, according to the possibilities offered by the chosen archetypes or templates. The following ADL fragment shows two levels of slot-filling:</p>
</div>
<div id="_tabs_21" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_21_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_21_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_21_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_21_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    use_archetype COMPOSITION[openEHR-EHR-COMPOSITION.xxx.v1] ∈ {
        /content ∈ {
            use_archetype SECTION[at0000, org.openehr::openEHR-EHR-SECTION.yyy.v1] ∈ {
                /items ∈ {
                    use_archetype EVALUATION[at0001, uk.nhs.cfh::openEHR-EHR-EVALUATION.t_xx.v1]
                    use_archetype EVALUATION[at0001, org.openehr::openEHR-EHR-EVALUATION.xx.v1]
                    use_archetype EVALUATION[at0002, org.openehr::openEHR-EHR-EVALUATION.xx.v1]
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_21_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_21_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    use_archetype COMPOSITION[openEHR-EHR-COMPOSITION.xxx.v1] ∈ {
        /content ∈ {
            use_archetype SECTION[id1, org.openehr::openEHR-EHR-SECTION.yyy.v1] ∈ {
                /items ∈ {
                    use_archetype EVALUATION[id2, uk.nhs.cfh::openEHR-EHR-EVALUATION.t_xx.v1]
                    use_archetype EVALUATION[id2, org.openehr::openEHR-EHR-EVALUATION.xx.v1]
                    use_archetype EVALUATION[id3, org.openehr::openEHR-EHR-EVALUATION.xx.v1]
                }
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that in the above the archetype fillers are specified as published archetypes, but in reality, it is far more likely that template-specific specialisations of these archetypes would be used. The identification and organisation of such archetypes is described in the openEHR Templates document.</p>
</div>
<div class="paragraph">
<p>In addition to or instead of specifying slot fillers, it is possible in a slot specialisation to narrow the slot definition, or to close it. If fillers are specified, closing the slot as well is typical. The latter is done by including an overridden version of the archetype slot object itself, with the 'closed' constraint set, as in the following example:</p>
</div>
<div id="_tabs_22" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_22_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_22_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_22_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_22_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    use_archetype SECTION[org.openehr::openEHR-EHR-SECTION.history_medical_surgical.v1] ∈ {
        /items ∈ {
            use_archetype EVALUATION[at0001, openEHR-EHR-EVALUATION.problem.v1]
            allow_archetype EVALUATION[at0001] closed
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_22_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_22_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    use_archetype SECTION[org.openehr::openEHR-EHR-SECTION.history_medical_surgical.v1] ∈ {
        /items ∈ {
            use_archetype EVALUATION[id2, openEHR-EHR-EVALUATION.problem.v1]
            allow_archetype EVALUATION[id2] closed
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Narrowing the slot is done with a replacement ` allow_archetype` statement containing a narrowed set of match criteria.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unconstrained_attributes"><a class="anchor" href="#_unconstrained_attributes"></a><a class="link" href="#_unconstrained_attributes">Unconstrained Attributes</a></h3>
<div class="paragraph">
<p>The <code>use_archetype</code> keyword can be used to specify child object constraints under any attribute in the reference model that is so far unconstrained by the flat parent of an archetype or template. Technically this could occur in any kind of archetype but would normally be in a specialised archetype or template. This is no more than the standard use of an 'external reference' (see <a href="#_external_references">[_external_references]</a>).</p>
</div>
<div class="paragraph">
<p>Any reference specified will have no slot, and is instead validity-checked against the appropriate part of the underlying reference model.</p>
</div>
<div class="paragraph">
<p>The following example from the openEHR reference model is typical.</p>
</div>
<div id="_tabs_23" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_23_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_23_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_23_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_23_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    COMPOSITION[at0000] matches {               -- Referral document
        category matches {...}
        context matches {
            EVENT_CONTEXT[at0001] matches {
                participations matches {...}
                other_context matches {...}
            }
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_23_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_23_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    COMPOSITION[id1] matches {               -- Referral document
        category matches {...}
        context matches {
            EVENT_CONTEXT[id2] matches {
                participations matches {...}
                other_context matches {...}
            }
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above cADL block partially specifies a <code>COMPOSITION</code> object, via constraints (often including slot definitions) on the <em>category</em> and <em>context</em> attributes defined on that class in the reference model. However, the attribute of most interest in a <code>COMPOSITION</code> object is usually the <em>content</em> attribute, which is not constrained at all here. The reference model defines it to be of type <code>List&lt;CONTENT_ITEM&gt;</code> .</p>
</div>
<div class="paragraph">
<p>Using an external reference in an unarchetyped part of the RM structure is almost always done in specialised archetypes or templates, but is valid in a top-level archetype.</p>
</div>
<div class="paragraph">
<p>The following example shows the use of <code>use_archetype</code> within a specialised archetype.</p>
</div>
<div id="_tabs_24" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_24_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_24_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_24_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_24_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    COMPOSITION[at0000.1] matches {        -- Referral document (specialisation)
        content matches {
            use_archetype SECTION[at0001, openEHR-EHR-SECTION.history_medical_surgical.v1]
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_24_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_24_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    COMPOSITION[id1.1] matches {        -- Referral document (specialisation)
        content matches {
            use_archetype SECTION[id2, openEHR-EHR-SECTION.history_medical_surgical.v1]
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_primitive_object_redefinition"><a class="anchor" href="#_primitive_object_redefinition"></a><a class="link" href="#_primitive_object_redefinition">Primitive Object Redefinition</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>For terminal objects (i.e. elements of the type <code>C_PRIMITIVE_OBJECT</code>) redefinition consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>addition of value constraints for nodes which in the parent are constrained solely to a primitive type (described in <a href="#cADL_Constraints_Primitive_Types">[cADL_Constraints_Primitive_Types]</a>);</p>
</li>
<li>
<p>redefined value ranges or sets using a narrower value range or set;</p>
</li>
<li>
<p>exclusions on the previously defined value ranges or sets which have the effect of narrowing the original range or set.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_numeric_primitive_redefinition"><a class="anchor" href="#_numeric_primitive_redefinition"></a><a class="link" href="#_numeric_primitive_redefinition">Numeric Primitive Redefinition</a></h3>
<div class="paragraph">
<p>The following example shows a redefined real value range.</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div id="_tabs_25" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_25_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_25_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_25_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_25_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    value ∈ {
        DV_QUANTITY[at9000] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_25_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_25_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    value ∈ {
        DV_QUANTITY[id3] ∈ {
            magnitude ∈ {|2.0..10.0|}
            units ∈ {"mmol/ml"}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specialised archetype:</p>
</div>
<div id="_tabs_26" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_26_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_26_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_26_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_26_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[at9000] ∈ {
            magnitude ∈ {|4.0..6.5|}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_26_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_26_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    .../value ∈ {
        DV_QUANTITY[id3] ∈ {
            magnitude ∈ {|4.0..6.5|}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_terminology_constraint_redefinition"><a class="anchor" href="#_terminology_constraint_redefinition"></a><a class="link" href="#_terminology_constraint_redefinition">Terminology Constraint Redefinition</a></h3>
<div class="paragraph">
<p>Redefinition of a terminology constraint follows the golden rule that redefinitions may only narrow constraints, not widen them, to preserve the instance / archetype validity relation up the specialisation lineage. The golden rule holds only for formal constraints, and is modified by the possibility of <a href="#_soft_terminology_constraint">non-binding constraint strengths</a>.</p>
</div>
<div class="sect3">
<h4 id="_constrain_previously_unconstrained_node"><a class="anchor" href="#_constrain_previously_unconstrained_node"></a><a class="link" href="#_constrain_previously_unconstrained_node">Constrain Previously Unconstrained Node</a></h4>
<div class="paragraph">
<p>The simplest form of terminology constraint specialisation is when a term constraint is used as a redefinition of a previously <em>unconstrained node</em>. This might simply be to require that a data item be of the appropriate reference model type, with no further constraint:</p>
</div>
<div id="_tabs_27" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_27_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_27_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_27_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_27_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[at0001]/events[at0002]/data[at0003]/items[at0021]/value ∈ {  -- cuff size
        DV_CODED_TEXT[at9000]  -- force a term of some kind
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_27_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_27_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[id2]/events[id3]/data[id4]/items[id22]/value ∈ {  -- cuff size
        DV_CODED_TEXT[id14]  -- force a term of some kind
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Alternatively, it may impose a value set, as follows:</p>
</div>
<div id="_tabs_28" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_28_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_28_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_28_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_28_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[at0001]/events[at0002]/data[at0003]/items[at0021]/value ∈ {  -- cuff size
        DV_CODED_TEXT[at9000] matches {[ac0.1]}
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_28_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_28_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    /data[id2]/events[id3]/data[id4]/items[id22]/value ∈ {  -- cuff size
        DV_CODED_TEXT[id14] matches {[ac0.1]}
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_terminology_internal_value_set_redefinition"><a class="anchor" href="#_terminology_internal_value_set_redefinition"></a><a class="link" href="#_terminology_internal_value_set_redefinition">Terminology Internal Value Set Redefinition</a></h4>
<div class="paragraph">
<p>The more typical redefinition case is when the parent node already states a terminology constraint with a value set, and the specialisation child redefines is, as per the following example.</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div id="_tabs_29" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_29_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_29_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_29_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_29_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ...
        ELEMENT[at0006] occurrences ∈ {0..*} ∈ {   -- System
            name ∈ {
                DV_CODED_TEXT[at9000] ∈ {
                    defining_code ∈ {[ac1]}
                }
            }
        }
    ...

terminology
    ...
    value_sets = &lt;
        ["ac1"] = &lt;
            id = &lt;"ac1"&gt;
            members = &lt;
                "at0007",   -- Cardiovascular system
                "at0008",   -- Respiratory system
                "at0009",   -- Gastro-intestinal system
                "at0010",   -- Reticulo-Endothelial system
                "at0011",   -- Genito-urinary system
                "at0012",   -- Endocrine System
                "at0013",   -- Central nervous system
                "at0014"    -- Musculoskeletal system
            &gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_29_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_29_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ...
        ELEMENT[id7] occurrences ∈ {0..*} ∈ {   -- System
            name ∈ {
                DV_CODED_TEXT[id14] ∈ {
                    defining_code ∈ {[ac1]}
                }
            }
        }
    ...

terminology
    ...
    value_sets = &lt;
        ["ac1"] = &lt;
            id = &lt;"ac1"&gt;
            members = &lt;
                "at8",    -- Cardiovascular system
                "at9",    -- Respiratory system
                "at10",   -- Gastro-intestinal system
                "at11",   -- Reticulo-Endothelial system
                "at12",   -- Genito-urinary system
                "at13",   -- Endocrine System
                "at14",   -- Central nervous system
                "at15"    -- Musculoskeletal system
            &gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specialised archetype:</p>
</div>
<div id="_tabs_30" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_30_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_30_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_30_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_30_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    .../name[at0013]/defining_code ∈ {[ac1.1]}

terminology
    ...
    value_sets = &lt;
        ["ac1.1"] = &lt;
            id = &lt;"ac1.1"&gt;
            members = &lt;
                "at0009",   -- Gastro-intestinal system
                "at0010",   -- Reticulo-Endothelial system
                "at0011",   -- Genito-urinary system
                "at0012",   -- Endocrine System
                "at0013",   -- Central nervous system
                "at0014"    -- Musculoskeletal system
            &gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_30_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_30_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    .../name[id14]/defining_code ∈ {[ac1.1]}

terminology
    ...
    value_sets = &lt;
        ["ac1.1"] = &lt;
            id = &lt;"ac1.1"&gt;
            members = &lt;
                "at10",   -- Gastro-intestinal system
                "at11",   -- Reticulo-Endothelial system
                "at12",   -- Genito-urinary system
                "at13",   -- Endocrine System
                "at15"    -- Musculoskeletal system
            &gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_terminology_external_subset_redefinition"><a class="anchor" href="#_terminology_external_subset_redefinition"></a><a class="link" href="#_terminology_external_subset_redefinition">Terminology External Subset Redefinition</a></h4>
<div class="paragraph">
<p>A terminology external subset constraint is used to set the value set of a coded term to be one defined externally in a terminology, specified in the <code>term_definitions</code> sub-section of the <code>terminology</code> section, as shown in the following example.</p>
</div>
<div id="_tabs_31" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_31_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_31_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_31_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_31_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ELEMENT [at0078] ∈ { -- cuff size
        value ∈ {
            DV_CODED_TEXT[at9000] ∈ {
                defining_code ∈ {[ac1]}
            }
        }
    }

terminology
    term_bindings = &lt;
        ["snomed_ct"]    = &lt;
            ["ac1"] = &lt;http://terminology.org/id/12000001&gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_31_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_31_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ELEMENT [id79] ∈ { -- cuff size
        value ∈ {
            DV_CODED_TEXT[id4] ∈ {
                defining_code ∈ {[ac1]}
            }
        }
    }

terminology
    term_bindings = &lt;
        ["snomed_ct"]    = &lt;
            ["ac1"] = &lt;http://terminology.org/id/12000001&gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In a specialisation of the archetype, the value set reference can be redefined in two different ways. The first is by redefinition of the constraint to a narrower one. This is a achieved by redefining the constraint code, and adding a new definition in the terminology of the specialised archetype, as follows.</p>
</div>
<div id="_tabs_32" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_32_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_32_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_32_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_32_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ELEMENT [at0078] ∈ {               -- cuff size
        value ∈ {
            DV_CODED_TEXT[at9000] ∈ {
                defining_code ∈ {[ac1.1]}
            }
        }
    }

terminology
    term_bindings = &lt;
        ["snomed_ct"]    = &lt;
            ["ac1.1"] = &lt;http://terminology.org/id/12000002&gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_32_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_32_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">definition
    ELEMENT [id79] ∈ {               -- cuff size
        value ∈ {
            DV_CODED_TEXT[id14] ∈ {
                defining_code ∈ {[ac1.1]}
            }
        }
    }

terminology
    term_bindings = &lt;
        ["snomed_ct"]    = &lt;
            ["ac1.1"] = &lt;http://terminology.org/id/12000002&gt;
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The second kind of redefinition is by an internal value set, as follows.</p>
</div>
<div id="_tabs_33" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_33_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_33_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_33_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_33_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">terminology
    ...
    value_sets = &lt;
        ["ac1"] = &lt;
            id = &lt;"ac1"&gt;
            members = &lt;"at0021",   -- child cuff
                       "at0022"&gt;   -- infant cuff
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
<div id="_tabs_33_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_33_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-adl" data-lang="adl">terminology
    ...
    value_sets = &lt;
        ["ac1"] = &lt;
            id = &lt;"ac1"&gt;
            members = "&lt;at22",   -- child cuff
                      "at23"&gt;    -- infant cuff
        &gt;
    &gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>These redefinitions are assumed to be valid, although they are not directly validatable unless the terminology subset is available to the tooling.</p>
</div>
</div>
<div class="sect3">
<h4 id="_constraint_strength_redefinition"><a class="anchor" href="#_constraint_strength_redefinition"></a><a class="link" href="#_constraint_strength_redefinition">Constraint Strength Redefinition</a></h4>
<div class="paragraph">
<p>Regardless of any changes to the value constraint, narrowing must also be respected for the constraint strength. Concretely, this means that a redefined terminology constraint may narrow the constraint strength by redefining any strength declared in a parent to any 'higher' strength, where the following order holds, from lowest to highest: <code>example</code> &#8594; <code>preferred</code> &#8594; <code>exensible</code> &#8594; <code>required</code>. Thus, the following redefinition from <code>preferred</code> to <code>required</code> may be made:</p>
</div>
<div id="_tabs_34" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_34_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_34_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_34_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_34_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    -- parent archetype
    name matches {
        DV_CODED_TEXT[at9000] matches {
            defining_code matches {preferred [ac1]}
        }
    }

    -- child archetype
    name matches {
        DV_CODED_TEXT[at9000.1] matches {
            defining_code matches {[ac1]}  -- i.e. required
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_34_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_34_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    -- parent archetype
    name matches {
        DV_CODED_TEXT[id13] matches {
            defining_code matches {preferred [ac1]}
        }
    }

    -- child archetype
    name matches {
        DV_CODED_TEXT[id13.1] matches {
            defining_code matches {[ac1]}  -- i.e. required
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A constraint with <code>required</code> strength cannot be redefined to any other strength in a specialised archetype.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Although the standard form <code>defining_code matches {[ac1]}</code> may always be used to represent 'required' strength, it is strongly recommended that the explicit form <code>defining_code matches {required [ac1]}</code> be used in specialised archetypes, <em>where the constraint strength is being redefined</em> (i.e. not for redefinition of a nodes where constraint strength is never mentioned).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It must be kept in mind that a constraint strength other than <code>required</code> is formally equivalent to <em>no constraint</em> - i.e. it is only a guide for tooling and human authors. The following two fragments are therefore completely equivalent.</p>
</div>
<div id="_tabs_35" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_35_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_35_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_35_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_35_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    -- non-required constraint strength
    name matches {
        DV_CODED_TEXT[at9000] matches {
            defining_code matches {preferred [ac1]}
        }
    }

    -- ... is the same as no constraint, other than RM type
    name matches {
        DV_CODED_TEXT[at9000]
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_35_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_35_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    -- non-required constraint strength
    name matches {
        DV_CODED_TEXT[id13] matches {
            defining_code matches {preferred [ac1]}
        }
    }

    -- ... is the same as no constraint, other than RM type
    name matches {
        DV_CODED_TEXT[id13]
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>This means that redefinition of a node containing a non-required constraint strength is formally speaking a redefinition of a node with no constraint on terminology code values. <em>The specialised node may therefore state any value set, regardless of what value set was stated in the parent</em>. This is true regardless of whether the constraint strength itself is redefined. For example, in the following a <code>preferred</code> strength node with value set <code>ac1</code> is redefined by another <code>preferred</code> node using a non-conforming value set <code>ac0.4</code>.</p>
</div>
<div id="_tabs_36" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_36_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_36_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_36_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_36_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    -- parent archetype
    name matches {
        DV_CODED_TEXT[at9000] matches {
            defining_code matches {preferred [ac1]}
        }
    }

    -- child archetype
    name matches {
        DV_CODED_TEXT[at9000.1] matches {
            defining_code matches {preferred [ac0.4]}
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_36_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_36_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    -- parent archetype
    name matches {
        DV_CODED_TEXT[id13] matches {
            defining_code matches {preferred [ac1]}
        }
    }

    -- child archetype
    name matches {
        DV_CODED_TEXT[id13.1] matches {
            defining_code matches {preferred [ac0.4]}
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tuple_redefinition"><a class="anchor" href="#_tuple_redefinition"></a><a class="link" href="#_tuple_redefinition">Tuple Redefinition</a></h3>
<div class="paragraph">
<p>Tuple constraints can be redefined by narrowing, as for other primitive constraints. A typical example is as follows.</p>
</div>
<div class="paragraph">
<p>Parent archetype:</p>
</div>
<div id="_tabs_37" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_37_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_37_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_37_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_37_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    DV_QUANTITY[at9000] ∈ {
        property ∈ {[at9001]}
        [magnitude, units] ∈ {
            [{|&gt;=50.0|}, {"mm[Hg]"}],
            [{|&gt;=68.0|}, {"cm[H20]"}]
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_37_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_37_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    DV_QUANTITY[id42] ∈ {
        property ∈ {[at29]}
        [magnitude, units] ∈ {
            [{|&gt;=50.0|}, {"mm[Hg]"}],
            [{|&gt;=68.0|}, {"cm[H20]"}]
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Child archetype:</p>
</div>
<div id="_tabs_38" class="openblock tabs is-loading">
<div class="content">
<div class="ulist tablist">
<ul>
<li id="_tabs_38_at_coded_adl2" class="tab">
<p>at-coded ADL2</p>
</li>
<li id="_tabs_38_id_coded_adl2" class="tab">
<p>id-coded ADL2</p>
</li>
</ul>
</div>
<div id="_tabs_38_at_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_38_at_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    DV_QUANTITY[at9000] ∈ {
        property ∈ {[at9001]}
        [magnitude, units] ∈ {
            [{|&gt;=50.0|}, {"mm[Hg]"}]
        }
    }</code></pre>
</div>
</div>
</div>
<div id="_tabs_38_id_coded_adl2--panel" class="tabpanel" aria-labelledby="_tabs_38_id_coded_adl2">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-cadl" data-lang="cadl">    DV_QUANTITY[id42] ∈ {
        property ∈ {[at29]}
        [magnitude, units] ∈ {
            [{|&gt;=50.0|}, {"mm[Hg]"}]
        }
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../master09.04-spec_attrib_redef/">Master09.04-Spec Attrib Redef</a></span>
  <span class="next"><a href="../master09.06-spec_rules/">Master09.06-Spec Rules</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>
    Copyright: © 2003+
    <a href="https://www.openehr.org"
        alt="is an independent, non-profit foundation, facilitating the sharing of health
           records by consumers and clinicians via open specifications, clinical models
           and open platform implementations.">The openEHR Foundation</a>
  </p>

  <p>
    License:
    <img src="/_/img/cc-by-nd-88x31.png"
        alt="Creative Commons Attribution-NoDerivs 3.0 Unported."
        style="vertical-align:middle;margin:0 0.25rem 0 0;">
    <a href="https://creativecommons.org/licenses/by-nd/3.0/">
      Creative Commons Attribution-NoDerivs 3.0 Unported.
    </a>
  </p>

  <p>
    <strong>Links: <strong>
    <a href="https://www.openehr.org/terms-of-use" class="mr-1">Terms of use</a> |
    <a href="https://www.openehr.org/privacy-policy" class="mx-1">Privacy policy</a> |
    <a href="https://www.openehr.org/privacy-policy" class="mx-1">Logos &amp; Trademarks</a> |
    <a href="https://www.openehr.org/contact-us" class="mx-1">Contact</a>
  </p>
</footer>

<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js"></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="80" data-stylesheet="../../../../_/css/search.css"></script>
<script async src="../../../../search-index.js"></script>
<script src="../../../../_/js/medium-zoom.min.js"></script>
<script src="../../../../_/js/zoom.js"></script>
  </body>
</html>
